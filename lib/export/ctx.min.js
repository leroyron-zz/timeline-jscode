this.ctx.discoverRenderer=function(c){return"CanvasRenderingContext2D"==c.constructor.name?"2d":"3d"};this.ctx.sprite=function(c,a,b,d,g,r,e,t,u,v,w,f,x,y){this.mode=this.discoverRenderer(this);this.sprite="2d"==this.mode?function(a,b,c,d,e,f,h,k,l,m,n,p,q){return this.Image.apply(this,[a,b,c,void 0,d,e,f,h,k,l,m,n,p,q])}:function(a,b,c,d,e,f,h,k,l,m,n,p,q,g){return this.Image.apply(this,[a,b,c,d,e,f,h,k,l,m,n,p,q,g])};return this.sprite.apply(this,arguments)};
var Check=function(c,a){for(var b=0;b<a.length;b++)if(c==a[b])return!1;return!0},Optin=function(c,a){var b=[],d;for(d in c)Check(d,a)&&b.push(d);for(d=0;d<b.length;d++)delete c[b[d]];return c};
this.ctx.Image=function(c,a,b,d,g,r,e,t,u,v,w,f,x,y){b=this.coords({x:a,y:b,width:g,height:r});a=new window.Image;a.name=/^(.+?)(\w*)(?:(\.[^.]*$)|$)/g.exec(c)[2];a.position={x:b.x,y:b.y,z:d};a.measure={width:b.width,height:b.height};a.position.offset="center"==e||"CC"==e?{left:b.width/2,top:b.height/2}:"CL"==e?{top:b.width/2,left:0}:"CR"==e?{top:b.width/2,left:b.width}:"TL"==e?{top:0,left:0}:"TC"==e?{top:0,left:b.width/2}:"TR"==e?{top:0,left:b.width}:"BL"==e?{top:b.height,left:0}:"BC"==e?{top:b.height,
left:b.width/2}:"BR"==e?{top:b.height,left:b.width}:{left:0,top:0};a.rotate={value:t||0,type:"rotation"};a.scale={value:u||.01};a.alpha={value:v||.01};a.sprite={value:w||0};if(f)for(d=0;d<f.length;d++)a[f[d][0]]=f[d][1];a.callback=x||function(){};a.args=y||[];a.onload=function(){0<this.args.length?this.callback.apply(this,this.args):this.callback();this.callback=this.onload=void 0};a.src=c;a.material||(a.material={attribute:{position:a.position,measure:a.measure}},a.material={uniforms:{rotate:a.rotate,
scale:a.scale,alpha:a.alpha,sprite:a.sprite}});return a};this.ctx.inView=function(c){return 1>=c&&-1<=c};this.ctx.coords=function(c){for(var a=["x","y","width","height"],b=0;b<a.length;b++)c[a[b]]&&(c[a[b]]=isNaN(c[a[b]])?/\d+/gi.exec(c[a[b]])<<0:this.inView(c[a[b]])||"x"!=a[b]&&"width"!=a[b]?this.inView(c[a[b]])||"y"!=a[b]&&"height"!=a[b]?c[a[b]]:2*-(c[a[b]]/this.canvas.height)+1:c[a[b]]/this.canvas.width*2-1);return c};this.ctx.coords.prototype.viewport=function(c){c.x=2*c.x-1;c.y=2*-c.y+1};
this.ctx.coords.prototype.normal=function(c){c.x=c.x/2+.5;c.y=-c.y/2+.5};