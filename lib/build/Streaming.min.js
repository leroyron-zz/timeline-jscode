/**
 * Streaming
 * @author leroyron / http://leroy.ron@gmail.com
 * //Streaming for javascript's linear parallelity
 */
var Streaming=function(N){Streaming=function(g){this.open=this.open||function(){this.build=function(e){try{this.stream=this.bindings.stream,this.nodesPerStream=this.bindings.nodesPerStream,this.propsPerNode=this.bindings.propsPerNode,this.propDataLength=this.bindings.propDataLength,this.continuancePosValData0=1,this.data0PropDataLength=this.continuancePosValData0+this.propDataLength,this.nodeDataLength=this.data0PropDataLength*this.propsPerNode+this.propsPerNode+1,this.data=this._prebuff(this.bindings.data),this.bindings.stream=this.bindings.nodesPerStream=this.bindings.propsPerNode=this.bindings.propDataLength=this.bindings.data=null,delete this.bindings.stream,delete this.bindings.nodesPerStream,delete this.bindings.propsPerNode,delete this.bindings.propDataLength,delete this.bindings.state,delete this.bindings.data,this._finalize(e)}catch(T){console.log("Streaming: No bindings - ref: http://")}finally{console.log("Streaming: ")}};this.access=this.access||function(e,g,B,C,J,a,d,b){var y=e,m=g,r=B,c=C,k=J,l=a,h=d,q=b;this.defaults={};this.mCount=this.tCount=this.rCount=0;this.runtimeCalls=[];this.ruclen=0;this.runtimeCallbacks=function(a){for(var c=0;c<this.ruclen;c++)this.runtimeCalls[c][1](this.runtimeCalls[c][0],a)};this.revertCalls=[];this.rrclen=0;this.revertCallbacks=function(a,c){for(var h=0;h<this.rrclen;h++)this.revertCalls[h][1](a||this.revertCalls[h][0],c)};this.update=function(a,b,f,d,v,e,z,I){y=a;m=b;r=f;c=d;k=v;l=e;h=z;q=I;this.updateCallbacks()};this.updateCalls=[];this.upclen=0;this.updateCallbacks=function(){for(var a=0;a<this.upclen;a++)this.updateCalls[a][1](this.updateCalls[a][0])};var z="stream",v,K,w,A,G,I,S;this._finalize=function(a){z=this.stream;v=this.nodesPerStream;K=this.propsPerNode;w=this.propDataLength;A=this.continuancePosValData0;G=this.data0PropDataLength;I=this.nodeDataLength;this.nodesPerStream=this.propsPerNode=this.data0PropDataLength=this.nodeDataLength=null;delete this.nodesPerStream;delete this.propsPerNode;delete this.data0PropDataLength;delete this.nodeDataLength;S=this.data.length;this.updateCallbacks();a()};this.revertFromTo=function(a,c){this.propDataLength=w=a;this.continuancePosValData0=A=c+1};this.reversion=function(a){return a-w*(a/w<<0)+A};this.method=this.option="Change the streaming process";this.process=function(a,h,b){switch(this.option){case"thrust":this.tCount=a+c;this.runtimeCallbacks(this.tCount);switch(this.method){case"all":this._thrustAll(this.tCount);break;case"nodes":this._thrustNodes(this.tCount,b);break;case"properties":this._thrustProperties(this.tCount,b);break;case"mix":this._thrustMix(this.tCount,b);break;default:this._thrustAll(this.tCount)}break;case"read":this.rCount=a+r;this.runtimeCallbacks(this.rCount);switch(this.method){case"all":this._readAll(this.rCount);break;case"nodes":this._readNodes(this.rCount,b);break;case"properties":this._readProperties(this.rCount,b);break;case"mix":this._readMix(this.rCount,b);break;default:this._readAll(this.rCount)}break;case"measure":switch(this.mCount=a+l,this.runtimeCallbacks(this.mCount),this.method){case"all":return[this._measureAll(this.mCount)];case"nodes":return[this._measureNodes(this.mCount,b)];case"properties":return[this._measureProperties(this.mCount,b)];case"mix":return[this._measureMix(this.mCount,b)];default:return[this._measureAll(this.mCount)]}}};this.output_utilizeMeasureData=this.output_utilizeThrustData=this.output_utilizeReadData="Data entry portal for execute, ref this to outer functions";var f=0,u=0,t=0,x=0,n,p,H,X=-1,F=0,D=0;this._checkInContinuance=function(){if(!y)return f;f+=this.data[p];this._updateDataPos();return f};this._updateDataPos=function(a){a=a||f;n=a-u-x;p=a-n};this._checkOutRevert=function(a){if(!k)return f;this.data[p]=n=this.reversion(n+(a||m));X!=n&&(X=n,this.output_revertCall(n),this.revertCallbacks(A,n),setTimeout(function(){X=-1},1E3));return n};this.output_revertCall="Data entry portal for execute, ref this to outer functions";this._callOutLeap=function(a){var c=this.bindings.ids["_bi"+F],b=c[D],h=c.node[z][b.binding].leap;h&&(this.data[a]=h.zeroIn||0,h.callback(),h.dispose&&(c.node[z][b.binding].leap=null,delete c.node[z][b.binding].leap))};this._readAll=function(a){for(t=u=f=0;f<S;f++)if(0==f%I&&(F=this.data[f],f++,u=1,t++),0==(f-t)%G&&(x=f-u,D=this.data[f],f++,u++,t++,n=f-u-x,p=f-n,H=p+(G-n-1),q&&(this.data[p]=A),f=this._checkInContinuance()),-1==F)f=H,this._updateDataPos();else if(0<a)this.output_utilizeReadData(this._dataVal(a),F,D);else break};this._dataVal=function(a){var c=this.data[f],b=n+a,d=p+b;b>w&&k&&(b=this._checkOutRevert(a),f=d=p+b);this.data[d]==h?(y&&(this.data[p]=b),this.data[d]=0):(f=d,this._updateDataPos(),this.data[p]=n,c=this.data[f]);f=H;this._updateDataPos();return c};this._thrustAll=function(a){for(t=u=f=0;f<S;f++)if(0==f%I&&(F=this.data[f],f++,u=1,t++),0==(f-t)%G&&(x=f-u,D=this.data[f],f++,u++,t++,n=f-u-x,p=f-n,H=p+(G-n-1),q&&(this.data[p]=A),f=this._checkInContinuance()),-1==F)f=H,this._updateDataPos();else if(0<a)this.output_utilizeThrustData(this._dataSum(a),F,D);else break};this._dataSum=function(a){for(var c=0,b=0;b<a;b++){var d=n+1,q=p+d;if(d>w)if(k)b--,d=this._checkOutRevert(1),f=p+d;else break;else if(this.data[q]==h){y&&(this.data[p]=d);this._callOutLeap(q);break}else f=q,this._updateDataPos(),this.data[p]=n,c+=this.data[f]}f=H;this._updateDataPos();return c};var V=0,E;this._measureAll=function(a){E=new Int32Array(new ArrayBuffer(a*K+K+4*v));for(t=u=f=V=0;f<S;f++)if(0==f%I&&(F=this.data[f],E[V++]=F,f++,u=1,t++),0==(f-t)%G&&(x=f-u,D=this.data[f],E[V++]=D,f++,u++,t++,n=f-u-x,p=f-n,H=p+(G-n-1),q&&(this.data[p]=A),f=this._checkInContinuance()),-1==F)f=H,this._updateDataPos();else if(0<a)this.output_utilizeMeasureData(this._dataReturn(a,E),F,D);else return;return E};this._dataReturn=function(a,c){for(var b=0;b<a;b++){var d=n+1,q=p+d;if(d>w)if(k)b--,f=p+A,this._updateDataPos();else break;else if(this.data[q]==h){f=H;this._updateDataPos();break}else f=q,this._updateDataPos(),c[V++]=this.data[f]}f=H;this._updateDataPos();return c};this.syncOffsets=function(a){for(t=u=f=0;f<S;f++)0==f%I&&(f++,u=1,t++),0==(f-t)%G&&(x=f-u,f++,u++,t++,n=f-u-x,p=f-n,H=p+(G-n-1),q&&(this.data[p]=A),f=this._checkInContinuance(),a>w&&(a=this._checkOutRevert(a))),this.data[p]=a,f=H,this._updateDataPos()};this.arguments={continuance:y,skip:m,rCount:r,tCount:c,revert:k,mCount:l,leap:h,reset:q,_accessed:!0};return this};this._prebuff=function(e){for(var g=e.length,B=new Int32Array(new ArrayBuffer(4*g)),C=0;C<g;C++)B[C]=e[C];return B};this.access.prototype.length=this.length};this.constructor.prototype.length=this.constructor.prototype.length||g;this.open.prototype.length=this.constructor.prototype.length;return this.open()};N(Streaming);return Streaming}(function(N){var g=N.prototype;g.addon={};g.open=function(){var a=this.open.prototype;a.addon=this.addon;g.open=void 0;var d=new N;d._access=d.access;d._access.prototype.addon=a.addon;d.access=function(){this.access=this._access;var a=this.access.apply(this,arguments),d;for(d in this.addon)for(var e in this.addon[d])if("access"==e)this.addon[d][e]=a;else for(var r in this.addon[d][e])"accessRuntime"==r&&(a.runtimeCalls.push([0,this.addon[d][e].runtime]),a.ruclen++),"accessRevert"==r&&(a.revertCalls.push([0,this.addon[d][e].revert]),a.rrclen++),"accessUpdate"==r&&(a.updateCalls.push([0,this.addon[d][e].update]),a.upclen++);return a};return d};var e=g.addon.runtime={access:void 0,system:function(){var a=this.constructor,d,b,e,m,r,c,k,l,h,q,z,v;this.update=function(){return this};this.proxy=function(){return this};this.init=function(){return this};this.Pointer=function(){d=a.pointer;this.Pointer=new d;return this};this.Knob=function(){b=a.knob;this.Knob=new b;return this};this.Subject=function(){e=a.subject;this.Subject=new e;return this};this.Marquee=function(){if(d||b||e)return m=a.marquee,this.Marquee=new m,this;console.log("System Marquee: No - Pointer, Knob or Subject detected")};this.Grid=function(){if(d||b||e)return r=a.grid,this.Grid=new r,this;console.log("System Grid: No - Pointer, Knob or Subject detected")};this.Parallax=function(){if(r)return c=this.Grid.parallax,this.Parallax=new c,this;console.log("System Parallax: No - Grid system detected")};this.Entity=function(){if(c)return k=this.Parallax.entity,this.Entity=new k,this;console.log("System Entity: No - Parallax system detected")};this.Physic=function(){if(c)return l=this.Parallax.physic,this.Physic=new l,this;console.log("System Physic: No - Parallax system detected")};this.Bound=function(){if(c)return h=this.Parallax.bound,this.Bound=new h,this;console.log("System Bound: No - Parallax system detected")};this.Collision=function(){if(c)return q=this.Parallax.collision,this.Collision=new q,this;console.log("System Collision: No - Parallax system detected")};this.Particle=function(){if(k||l||h||q)return z=this.Parallax.particle,this.Particle=new z,this;console.log("System Particle: No - Entity, Physic, Bound or Collision detected")};this.Rig=function(){if(k||l||h||q)return v=this.Parallax.rig,this.Rig=new v,this;console.log("System Rig: No - Entity, Physic, Bound or Collision detected")};return this instanceof a?this.That:new a}};g.addon.runtime.system.pointer=function(){var a=this.constructor,d={},b={},e={};this.bind=function(a,c){d=a;b=c;return this};this.result=function(a){e=a;return this};this.init=function(){b.onmousedown=b.ontouchstart=function(a){a.preventDefault();if(d.enabled)if(a.changedTouches)for(var c=0,b=a.changedTouches.length;c<b;c++)m(!0,d,a.changedTouches[c].identifier,a,this,function(a){e(a)});else m(!1,d,0,a,this,function(a){e(a)})};b.onmousemove=b.ontouchmove=function(a){a.preventDefault();if(d.inUse)if(a.changedTouches)for(var c=0,b=a.changedTouches.length;c<b;c++)m(!0,d,a.changedTouches[c].identifier,a,this,function(a){e(a)},!0);else m(!1,d,0,a,this,function(a){e(a)},!0);else a.changedTouches||m(!1,d,0,a,this,function(a){e(a)},!0)};b.onmouseup=b.ontouchend=function(a){a.preventDefault();if(d.enabled)if(a.changedTouches)for(var c=0,b=a.changedTouches.length;c<b;c++){a:{var e=a.targetTouches;for(var h=0,q=e.length;h<q;h++)if(e[h].identifier===a.changedTouches[c].identifier){e=!0;break a}e=!1}e||delete d[a.changedTouches[c].identifier]}else d.inUse=!1,delete d[0]};return this};var m=function(a,c,b,e,h,q,z){c[b]||(c[b]=e,c[b].normal={});var v,k;if(a)if(e.targetTouches[b])var w=e.targetTouches[b];else if(console.log("touch missed"),e.changedTouches[b])w=e.changedTouches[b];else{console.log("exiting");return}else w=e;c[b].mX=v=w.pageX;c[b].mY=k=w.pageY;c[b].normal.x=(v-h.offsetLeft)/h.clientWidth*2-1;c[b].normal.y=2*-((k-h.offsetTop)/h.clientHeight)+1;q(c[b]);if(!z){if("mousedown"==e.type||"touchstart"==e.type)d.inUse=!0;if("mouseup"==e.type||"touchend"==e.type)d.inUse=!1;a&&(d.multi=!1,0==w.length?d.inUse=!1:1<w.length&&(d.multi=!0));c[b].area=v>h.clientWidth/2?"right":"left"}};return this instanceof a?this.That:new a};g.addon.runtime.system.knob=function(){var a=this.constructor;this.bind=function(){return this};this.result=function(a){return this};this.init=function(){return this};return this instanceof a?this.That:new a};g.addon.runtime.system.subject=function(){var a=this.constructor;this.bind=function(){return this};this.result=function(a){return this};this.init=function(){return this};return this instanceof a?this.That:new a};g.addon.runtime.system.marquee=function(){var a=this.constructor;this.bind=function(){return this};this.result=function(a){return this};this.init=function(){return this};return this instanceof a?this.That:new a};g.addon.runtime.system.grid=function(){var a=this.constructor;this.layers={};var d=[],b=[],e=0,m={};this.update=function(){return this};this.mode=function(a){return this};this.dir=function(a){this.dir=a;return this};this.batches=function(){d=arguments;return this};this.offsets=function(){b=arguments;return this};this.properties=function(a){e=a.count;this.name=a.name;this.columns=a.columns;this.rows=a.rows;m.width=a.width;m.height=a.height;return this};this.syntax=function(a){this.syntax=a;return this};this.assign=function(a){this.assign=a;return this};this.init=function(){for(var a=0;a<d.length;a++){this.batch={name:d[a],index:a};this.layers[this.batch.name]={offset:b[a],update:this.update,grid:[]};for(var k=0;k<e;k++){var l=k/this.columns<<0,h=k-l*this.columns;this.layers[this.batch.name].grid[h]||(this.layers[this.batch.name].grid[h]=[]);this.layers[this.batch.name].grid[h][l]={};this.layers[this.batch.name].grid[h][l]=this.assign(this.syntax(k),k,this.batch,h,l,m,this.layers[this.batch.name].grid[h][l])}}return this.layers};for(var g in a)this[g]=a[g];return this instanceof a?this.That:new a};g.addon.runtime.system.grid.parallax=function(){var a=this.constructor;this.update=function(){return this};this.field=function(a){return this};this.separation=function(){return this};this.update=function(){return this};this.func=function(){return this};this.move=function(){return this};this.init=function(){return this};for(var d in a)this[d]=a[d];return this instanceof a?this.That:new a};g.addon.runtime.system.grid.parallax.entity=function(){var a=this.constructor;this.bind=function(){return this};this.result=function(a){return this};this.init=function(){return this};return this instanceof a?this.That:new a};g.addon.runtime.system.grid.parallax.physic=function(){var a=this.constructor;this.bind=function(){return this};this.result=function(a){return this};this.init=function(){return this};return this instanceof a?this.That:new a};g.addon.runtime.system.grid.parallax.bound=function(){var a=this.constructor;this.bind=function(){return this};this.result=function(a){return this};this.init=function(){return this};return this instanceof a?this.That:new a};g.addon.runtime.system.grid.parallax.collision=function(){var a=this.constructor;this.bind=function(){return this};this.result=function(a){return this};this.init=function(){return this};return this instanceof a?this.That:new a};g.addon.runtime.system.grid.parallax.particle=function(){var a=this.constructor;this.bind=function(){return this};this.result=function(a){return this};this.init=function(){return this};return this instanceof a?this.That:new a};g.addon.runtime.system.grid.parallax.rig=function(){var a=this.constructor;this.bind=function(){return this};this.result=function(a){return this};this.init=function(){return this};return this instanceof a?this.That:new a};g.addon.binding=function(a,d,b,y,m,r){var c=g.addon;e.access.defaults.relative=e.access.defaults.relative||!1;e.access.bindings=e[a]=e[a]||{stream:a,data:[],nodesPerStream:0,propsPerNode:y.length,propDataLength:g.length,state:"prebuff",continuancePosValData0:1,reversion:function(a){return a-this.propDataLength*(a/this.propDataLength<<0)+this.continuancePosValData0}};e[a].nodesPerStream+=d.length;var k=e[a];k.length=k.length||g.length;k.ids=k.ids||{};var l=g.length;d[0][0].type=d[0][0].type?"position"==d[0][0].type||"rotation"==d[0][0].type||"f"==d[0][0].type||"Vector3"==d[0][0].constructor.name||"Euler"==d[0][0].constructor.name?d[0][0].type:b[0][0]:b[0][0];var h=d[0][0].type=Math.Type.identify(d[0][0]);c.buffIdKey=c.buffIdKey||800;c.propIdKey="rotation"==h?806:801;var q=r||Math.Type.precision(h),z=m||e.access.defaults.relative,v=[];for(m={};0<d.length;)m.props="poly"==h?Math.Poly.generate(h,b[0][1],q):Math.Type.convertToPrecisionData(h,b.concat(),1,2,q),r="poly"==h?Math.Poly.generateKeys(b[0][1],y[y.length-1]):y.concat(),m.buffKey=d[0][1]||c.buffIdKey,k.ids["_bi"+m.buffKey]=new(function(b){return function(e){d[0][0]=d[0][0]||{};d[0][0][a]={binding:"_bi"+b.buffKey,position:k.data.length,relative:z,conversion:h,precision:q};k.data.push(c.buffIdKey=b.buffKey);c.buffIdKey++;for(var w={};0<b.props.length;)w.propKey=e[0]||c.propIdKey,this[w.propKey]=new(function(b){return function(c){this.binding=c[0][0];c[0][1]=c[0][1]||0;this.value=c[0][1];d[0][0][c[0][0]]="value"==c[0][0]?c[0][1]:c[0][1]/q;d[0][0][a][c[0][0]]={binding:b.propKey,data0PosI:k.data.length+1};k.data.push(b.propKey);k.data.push(1);for(var h=0;h<l;h++)c[0][2]?z?k.data.push((c[0][2]-c[0][1])/l):k.data.push(c[0][1]+(c[0][2]-c[0][1])/l*h):z?k.data.push(0):k.data.push(c[0][1])}}(w))(b.props),k.propsPerNode=e.length>k.propsPerNode?e.length:k.propsPerNode,e.shift(),b.props.shift(),c.propIdKey=w.propKey,c.propIdKey++,w={propKey:w.propKey};this.node=d[0][0];v.push(this.node)}}(m))(r),d.shift(),m={buffKey:m.buffKey,props:m.props};return v};g.addon.buffer=function(){var a=g.addon.buffer={evals:0};a.update=function(){this.updateCallbacks()};a.updateCalls=[];a.upclen=0;a.updateCallbacks=function(){for(var a=0;a<this.upclen;a++)this.updateCalls[a][1](this.updateCalls[a][0])};a.presets=function(a){for(var b in a)m.presets[b]=a[b]};var d,b,y,m={presets:{}},r=function(a,b,e){for(var c=this.CSPL||{},d=m.presets[a].CPs,k=m.presets[a].duration,v=m.presets[a].precision,g=d.length,w=[],l=0;l<g;l++)w[l]={t:d[l].t/k*b,p:d[l].p/v*e||d[l].p};b=[];d=[];k=[];for(v=0;v<g;v++)l=w[v],b[v]=l.t,d[v]=l.p,k[v]=1;c.getNaturalKs(b,d,k);v=w[0].t;g=w[g-1].t;for(w=new Int32Array(new ArrayBuffer(4*g));v<=g;v++)w[v]=c.evalSpline(v,b,d,k);return[w,e||m.presets[a].precision]};a.eval=function(c,k,l,h,q,z,v,g,w,m){e.access.defaults.relative=e.access.defaults.relative||!1;l=l||e.access.defaults.relative;for(var G=[],I=0,A=k.length;I<A;I++){var f=k[I];var u=f[0];var t=f[2];for(var x=f[3],n=[],p=0,H=u.length;p<H;p++){for(var K=u[p],F=f[1],D=0,B=F.length;D<B;D++){d=0;if(x)if(1==x)d-=y;else if(1<x||1>x)d+=x;b=0;var E=F[D];n[D]=F[D][0];for(var C=0,J=E.length;C<J;C++){var L=E[C];n[D]=L[0];for(var N=0,A=0,R=t.length;A<R;A++)t[A][1]<<=0,N+=t[A][1];R=0;for(A=t.length;R<A;R++){var U=t[R];y=U[1];L[2]=y/N*L[1];L[2]=Math.Type.convertToPrecision(K[c].conversion,L[2]);for(var P=r(U[0],y,h||y),U=l,T=m,ba=K[L[0]]+b,Z=K[c][L[0]].data0PosI,O="prebuff"==e[c].state?e[c]:e.access,Y=O.data[Z],Y=Y+d,ca=O.propDataLength+1,aa=L[2],W=P[0],P=P[1],da=W.length,Q=0;Q<da;Q++){var M=Y+Q,M=M<ca?M:O.reversion(M),M=Z+M;T&&O.data[M]==O.arguments.leap||(O.data[M]=U?O.data[M]+((W[Q]-(W[Q+1]||0))/(P/aa)<<0):ba+(P-W[Q])/P*aa<<0)}a.update();d+=y;b+=L[2]}}}z&&a.assignLeap(c,[K],n,!1,d,z,v,g,w);q&&(G[p]=a.getData(c,[K],n,q))}}a.evals+=u.length*t.length;a.update();return G};a.assignLeap=function(a,b,d,h,q,z,v,g,w){for(var c="prebuff"==e[a].state?e[a]:e.access,k=c.propDataLength+1,l=0,m=b.length;l<m;l++)for(var f=b[l][a],u=0,t=d.length;u<t;u++){var x=f[d[u]],n=x.data0PosI,p=c.data[n];if(x.leap&&v){var r=x.leap.dataPosI;c.data[r]=0}x.leap={callback:z,dataPos:h?q:p+q,dispose:"undefined"==typeof g?!0:g,zeroIn:w};p=x.leap.dataPos;p=p<k?p:c.reversion(p);n+=p;c.data[n]=c.arguments.leap;x.leap.dataPosI=n}};a.zeroOut=function(a,b,d,h,q,z){var c="prebuff"==e[a].state?e[a]:e.access,k=c.propDataLength+1;d-=b;if(h&&q)for(var g=0,m=h.length;g<m;g++)for(var l=h[g][a],r=0,y=q.length;r<y;r++)for(var f=l[q[r]].data0PosI,u=0;u<d;u++){var t=b+u,t=t<k?t:c.reversion(t),t=f+t;z&&c.data[t+1]==c.arguments.leap||(c.data[t+1]=0)}else for(g in c.bindings.ids)for(m in h=c.bindings.ids[g].node[a],h)if(h[m].data0PosI)for(q=h[m].data0PosI,l=0;l<d;l++)r=b+l,r=r<k?r:c.reversion(r),r=q+r,z&&c.data[r+1]==c.arguments.leap||(c.data[r+1]=0)};a.valIn=function(b,d,g,h,q,z,v,m,w,r,y,I,C,f){var c="prebuff"==e[b].state?e[b]:e.access,k=c.propDataLength+1;if(d&&g)for(var l=0,n=d.length;l<n;l++){var p=d[l][b];v=v||p.precision;for(var A=0,G=g.length;A<G;A++)for(var K=p[g[A]].data0PosI,D=z-q,B=0;B<D;B++){var E=q+B,E=E<k?E:c.reversion(E),E=K+E;f&&c.data[E+1]==c.arguments.leap||(c.data[E+1]=h*v)}}r&&a.assignLeap(b,[d[0]],g,m,w,r,y,I,C)};a.getData=function(a,b,d,h,q){for(var c="prebuff"==e[a].state?e[a]:e.access,g=c.propDataLength+1,k=[],m=0,l=b.length;m<l;m++){var r=b[m][a];k[m]={};for(var y=0,B=d.length;y<B;y++)for(var f=d[y],u=r[f].data0PosI,t=c.data[u]+2,x=k[m][f]=0;x<h;x++){var n=t+x,n=n<g?n:c.reversion(n),n=u+n;q&&c.data[n+1]==c.arguments.leap||(k[m][f]+=c.data[n+1]/r.precision)}}return k};a.injectData=function(a,b,d,h,q,g){for(var c="prebuff"==e[a].state?e[a]:e.access,m=c.propDataLength,k=0,r=b.length;k<r;k++)for(var l=b[k][a],z=0,y=d.length;z<y;z++){var f=l["poly"==l.conversion?0:d[z]].data0PosI;var u=c.data[f];for(var t=0;t<q;t++){var x=u+t,x=x<m?x:c.reversion(x);if("poly"==l.conversion)for(var n=0,y=h.length;n<y;n++){f=l[n].data0PosI;var p=f+x;g&&c.data[p]==c.arguments.leap||(c.data[p]=h[n]*l.precision)}else p=f+x,g&&c.data[p]==c.arguments.leap||(c.data[p]=h*l.precision)}}};return a};var T=g.addon.buffer();g.addon.buffer.ease=function(){var a=g.addon.buffer.ease={};a.precisions=100;a.update=function(){d=this.precisions;var a=b.precisions,e;for(e in b){for(var g in b[e].CPs)b[e].CPs[g].p=b[e].CPs[g].p/a*d;b[e].duration=b.durations;b[e].precision=d}b.precisions=d;T.presets(b);this.updateCallbacks()};a.updateCalls=[];a.upclen=0;a.updateCallbacks=function(){for(var a=0;a<this.upclen;a++)this.updateCalls[a][1](this.updateCalls[a][0])};var d=a.precisions;var b={durations:100,precisions:100,linear:{CPs:[{t:0,p:100},{t:50,p:50},{t:100,p:0}]},easeInSine:{CPs:[{t:0,p:100},{t:17,p:96},{t:100,p:0}]},easeOutSine:{CPs:[{t:0,p:100},{t:83,p:3},{t:100,p:0}]},easeInOutSine:{CPs:[{t:0,p:100},{t:19,p:92},{t:81,p:8},{t:100,p:0}]},easeInQuad:{CPs:[{t:0,p:100},{t:32,p:89},{t:75,p:44},{t:100,p:0}]},easeOutQuad:{CPs:[{t:0,p:100},{t:17,p:69},{t:74,p:6},{t:100,p:0}]},easeInOutQuad:{CPs:[{t:0,p:100},{t:17,p:93},{t:35,p:75},{t:55,p:40},{t:80,p:7},{t:100,p:0}]},easeInCubic:{CPs:[{t:0,p:100},{t:17,p:99},{t:42,p:92},{t:66,p:71},{t:86,p:35},{t:100,p:0}]},easeOutCubic:{CPs:[{t:0,p:100},{t:15,p:59},{t:33,p:30},{t:57,p:8},{t:83,p:0},{t:100,p:0}]},easeInOutCubic:{CPs:[{t:0,p:100},{t:22,p:96},{t:38,p:77},{t:50,p:50},{t:64,p:18},{t:82,p:2},{t:100,p:0}]},easeInQuart:{CPs:[{t:0,p:100},{t:21,p:100},{t:42,p:96},{t:63,p:84},{t:82,p:54},{t:92,p:28},{t:100,p:0}]},easeOutQuart:{CPs:[{t:0,p:100},{t:12,p:58},{t:27,p:28},{t:45,p:9},{t:66,p:1},{t:81,p:0},{t:100,p:0}]},easeInOutQuart:{CPs:[{t:0,p:100},{t:15,p:100},{t:28,p:94},{t:41,p:76},{t:50,p:49},{t:57,p:26},{t:68,p:8},{t:84,p:0},{t:100,p:0}]},easeInQuint:{CPs:[{t:0,p:100},{t:24,p:100},{t:43,p:98},{t:64,p:89},{t:81,p:64},{t:93,p:28},{t:100,p:0}]},easeOutQuint:{CPs:[{t:0,p:100},{t:9,p:61},{t:23,p:26},{t:37,p:10},{t:59,p:1},{t:78,p:0},{t:100,p:0}]},easeInOutQuint:{CPs:[{t:0,p:100},{t:16,p:99},{t:28,p:96},{t:45,p:70},{t:52,p:39},{t:60,p:17},{t:75,p:1},{t:88,p:0},{t:100,p:0}]},easeInExpo:{CPs:[{t:0,p:100},{t:9,p:99},{t:56,p:94},{t:72,p:85},{t:83,p:69},{t:92,p:42},{t:100,p:0}]},easeOutExpo:{CPs:[{t:0,p:100},{t:5,p:70},{t:22,p:21},{t:48,p:3},{t:64,p:1},{t:93,p:0},{t:100,p:0}]},easeInOutExpo:{CPs:[{t:0,p:100},{t:11,p:99},{t:21,p:99},{t:30,p:96},{t:38,p:90},{t:47,p:67},{t:53,p:33},{t:60,p:12},{t:72,p:2},{t:79,p:0},{t:85,p:0},{t:100,p:0}]},easeInCirc:{CPs:[{t:0,p:100},{t:33,p:94},{t:54,p:83},{t:81,p:58},{t:94,p:35},{t:99,p:10},{t:100,p:0}]},easeOutCirc:{CPs:[{t:0,p:100},{t:1,p:90},{t:6,p:66},{t:14,p:48},{t:26,p:32},{t:41,p:19},{t:60,p:8},{t:79,p:2},{t:100,p:0}]},easeInOutCirc:{CPs:[{t:0,p:100},{t:17,p:97},{t:27,p:92},{t:37,p:83},{t:44,p:74},{t:47,p:67},{t:49,p:60},{t:50,p:50},{t:51,p:41},{t:53,p:31},{t:57,p:22},{t:62,p:17},{t:71,p:9},{t:82,p:3},{t:100,p:0}]},easeInBack:{CPs:[{t:0,p:100},{t:4,p:100},{t:64,p:100},{t:86,p:53},{t:100,p:0}]},easeOutBack:{CPs:[{t:0,p:100},{t:3,p:86},{t:35,p:1},{t:95,p:0},{t:100,p:0}]},easeInOutBack:{CPs:[{t:0,p:100},{t:3,p:100},{t:46,p:69},{t:51,p:44},{t:56,p:22},{t:97,p:0},{t:100,p:0}]},easeInElastic:{CPs:[{t:0,p:100},{t:8,p:99},{t:15,p:99},{t:22,p:100},{t:32,p:100},{t:41,p:98},{t:47,p:99},{t:63,p:99},{t:74,p:90},{t:93,p:93},{t:95,p:60},{t:100,p:0}]},easeOutElastic:{CPs:[{t:0,p:100},{t:3,p:65},{t:7,p:2},{t:26,p:11},{t:38,p:0},{t:56,p:1},{t:69,p:0},{t:75,p:0},{t:83,p:0},{t:90,p:0},{t:100,p:0}]},easeInOutElastic:{CPs:[{t:0,p:100},{t:13,p:100},{t:23,p:99},{t:33,p:99},{t:45,p:95},{t:48,p:67},{t:51,p:41},{t:55,p:4},{t:67,p:0},{t:78,p:0},{t:87,p:0},{t:100,p:0}]},easeInBounce:{CPs:[{t:0,p:100},{t:4,p:98},{t:8,p:100},{t:12,p:96},{t:23,p:97},{t:26,p:100},{t:28,p:96},{t:60,p:95},{t:63,p:100},{t:68,p:80},{t:87,p:13},{t:100,p:0}]},easeOutBounce:{CPs:[{t:0,p:100},{t:15,p:83},{t:28,p:40},{t:33,p:17},{t:36,p:2},{t:38,p:4},{t:71,p:4},{t:73,p:0},{t:77,p:4},{t:88,p:3},{t:91,p:0},{t:94,p:1},{t:100,p:0}]},easeInOutBounce:{CPs:[{t:0,p:100},{t:3,p:98},{t:5,p:99},{t:9,p:97},{t:13,p:99},{t:16,p:94},{t:28,p:94},{t:31,p:98},{t:37,p:77},{t:44,p:55},{t:55,p:46},{t:64,p:19},{t:68,p:1},{t:72,p:6},{t:82,p:7},{t:86,p:0},{t:91,p:3},{t:95,p:0},{t:97,p:1},{t:100,p:0}]}};a.update()};g.addon.buffer.ease();g.addon.timeframe=function(){var a=g.addon.timeframe={};a.process=void 0;a.invoke=void 0;a.length=void 0;a.init=!1;a.ready=!1;a.running=!1;a.control=!1;a.lapse=10;a.duration=0;a.read=0;a.thrust=0;a.mode="2d";a.runtime=function(){this.runtimeCallbacks()};a.runtimeAuthority=function(a,b,c){e[b].script[c]=a};a.clearRuntimeAuthority=function(a,b){b?e[a].script.splice(b,1):e[a].script=[]};a.revert=function(a){this.revertCallbacks(a)};a.revertCalls=[];a.rrclen=0;a.revertCallbacks=function(a){for(var b=0;b<this.rrclen;b++)this.revertCalls[b][1](this.revertCalls[b][0],a)};var d=function(b){a.revert(b)};a.update=function(){b.process=this.process;b.invoke=this.invoke;b.length=this.length;b.running=this.running;b.lapse=this.lapse;this.updateCallbacks&&this.updateCallbacks();"3d"==a.mode?(m(),k()):(r(),l());c();e.access.output_revertCall=d};a._init=function(a){this.mode="CanvasRenderingContext2D"==a.canvases["0"].context.constructor.name?"2d":"3d";this.length=e[e.access.stream].length;this.init=!0};a._ready=function(){this.ready=!0};a.run=function(){!this.running&&this.ready&&(b.now=b._then=Date.now(),this.length=e[e.access.stream].length,this.running=!0,this.update(),y())};a.stop=function(a){this.running&&(this.running=!1,this.update(),window.cancelAnimationFrame(b.animationFrameLoop));a&&(this.duration=a,this.syncing())};a.tick=function(a,c){b.byFrame.exact=a||b.byFrame.exact;b.byFrame.number=c||1;this.running=!1;this.run()};a.keyPauseToggle=function(a){a&&(console.log("KeyCode:"+a.keyCode),32==a.keyCode&&(this.running?this.stop():this.run()))};a.syncing=function(a){e.access.syncOffsets(a||this.duration)};var b={_then:Date.now(),access:"read",_remain:0,lapse:a.lapse,byFrame:{number:0,exact:!1},frame:a},y=function(){b.running&&(window.stats.begin(),b.now=Date.now(),b._delta=b.now-b._then+b._remain,a[b.access]=b._timeFrame=b._delta/10<<0,b.process(),b._remain=b._delta-10*b._timeFrame,b._then=b.now,0<b._timeFrame&&b._timeFrame<b.lapse&&(a.runtime(),b.byFrame.exact?b.byFrame.exact&&(e.access.process(1),b.byFrame.exact=!1,b.byFrame.number=0,a.stop()):(e.access.process(b._timeFrame),0<b.byFrame.number&&(1==b.byFrame.number&&a.stop(),b.byFrame.number--),a.duration+=b._timeFrame),b.invoke()),b.animationFrameLoop=window.requestAnimationFrame(y),window.stats.end())};a.switchToTimeFrameThrusting=function(a){b.access="thrust";e.access.defaults.relative=!0;a&&c(a-1)};var m=function(){e.access.output_utilizeThrustData=function(a,b,c){if(0!=a){b=this.bindings.ids["_bi"+b];var d=b[c];d.value+=a;b.node[d.binding]=d.value/b.node[this.stream].precision;806==c&&(b.node.blockCallback=!1)}}},r=function(){e.access.output_utilizeThrustData=function(a,b,c){0!=a&&(b=this.bindings.ids["_bi"+b],c=b[c],c.value+=a,b.node[c.binding]=c.value/b.node[this.stream].precision)}};a.switchToTimeFrameReading=function(a){b.access="read";e.access.defaults.relative=!1;a&&c(a-1)};var c=function(c){e.access.option=b.access;e.access.method="all";e.access.rCount=e.access.tCount=1;a.syncing(c)},k=function(){e.access.output_utilizeReadData=function(a,b,c){b=this.bindings.ids["_bi"+b];var d=b[c];d.value=a;b.node[d.binding]=d.value/b.node[this.stream].precision;806==c&&(b.node.blockCallback=!1)}},l=function(){e.access.output_utilizeReadData=function(a,b,c){b=this.bindings.ids["_bi"+b];c=b[c];c.value=a;b.node[c.binding]=c.value/b.node[this.stream].precision}};a.resetStreamProperties=function(){e.access.revertFromTo(this.length,0)};return a};for(var B=g.addon.timeframe(),C=["comment","segment","action","sound"],J={ci:0};J.ci<C.length;J={ci:J.ci},J.ci++)g.addon.timeframe[C[J.ci]]=function(a){return function(){var d=e[C[a.ci]]={script:[]};d.accessRuntime=void 0;d.runtime=function(a,e){if(!B.control)for(var b=a+e+B.duration,g=a+B.duration;g<b;g++)d.script[g]&&d.script[g].main()};d.accessRevert=void 0;d.revert=function(a,e){if(!B.control)for(var b=a+e+B.duration-B.duration,g=a;g<b;g++)d.script[g]&&d.script[g].main()}}}(J),g.addon.timeframe[C[J.ci]]()});